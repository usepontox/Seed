name: Deploy Automático na Hostinger (Deeppdvs.com.br)

on:
  push:
    branches:
      - main 

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: 1. Checkout do código
        uses: actions/checkout@v4
      
      # --- Etapas de Build ---
      - name: 2. Configurar Node.js (Vite)
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Ajuste a versão se necessário
          cache: 'npm' 
          
      - name: 3. Instalar dependências
        run: npm install 

      - name: 4. Build do Projeto (Gera a pasta 'dist')
        run: npm run build 
        env:
          # Variáveis do Supabase (para o ambiente de build)
          VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL }}
          VITE_SUPABASE_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY }}
          
      # --- Etapa de Deploy FTP/SFTP (SamKirkland/FTP-Deploy-Action) ---
      - name: 5. Deploy definitivo para Hostinger (FTP/SFTP)
        # ACTION MAIS ESTÁVEL E POPULAR
        uses: SamKirkland/FTP-Deploy-Action@v4.3.0
        with:
          # CORREÇÃO AQUI: USANDO HÍFEN NO FORMATO DA ACTION (server-host, ftp-username, ftp-password)
          server-host: ${{ secrets.FTP_SERVER }}
          ftp-username: ${{ secrets.FTP_USERNAME }}
          ftp-password: ${{ secrets.FTP_PASSWORD }}
          
          # Protocolo: FTPS é o método seguro, compatível com a Hostinger (Porta 21)
          protocol: ftps 
          
          # Caminho Local: A pasta 'dist/' que o Vite gera
          local-path: './dist/'
          
          # Caminho Remoto: O destino 'public_html/' na Hostinger
          remote-path: 'public_html/' 
          
          # Opção para deletar arquivos que não existem mais no local
          delete: true
          
